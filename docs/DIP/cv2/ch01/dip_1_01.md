# Basic Operations on Images

## 목표

* pixel의 intensity 또는 color vector의 값을 읽거나 수정학.
* image의 property들을 확인하기
* ROI설정하기.
* image를 여러 축으로 나누거나 합치기.

OpenCV는 python binding에서 기본 데이터 구조로 NumPy의 ndarray를 채택하고 있기 때문에 NumPy의 ndarray를 다루는 방법으로 image를 처리할 수 잇다.

## Pixl 개개의 값에 접근하고 수정하기.

우선 가장 간단한 gray-scale image에서 접근 및 수정은 결국 pixel intensity가 scalar이므로 단일값에 대한 읽기와 수정이 된다.

```Python
url = 'https://raw.githubusercontent.com/dsaint31x/OpenCV_Python_Tutorial/master/images/cat_cv.tif'

import requests

def get_img(url):
    image_ndarray = np.asarray(bytearray(requests.get(url).content), dtype=np.uint8)
    img = cv2.imdecode(image_ndarray, cv2.IMREAD_UNCHANGED)
    return img

src = get_img(url)

if src is None:
    print('Error: invalid url!')
else:
    img = src.copy()

intensity = img[100,100]
print(f'img[100,100]={intensity}')
```

Color image의 경우, 3~4개의 element를 가진 vector가 한 pixel에 할당되어 있다. 각 element를 channel 혹은 depth라고 부른다. : BGR(A)

```Python
import cv2
import numpy as np
import matplotlib.pyplot as plt

url = 'https://raw.githubusercontent.com/dsaint31x/OpenCV_Python_Tutorial/master/images/messi5.jpg'

src = get_img(url)

if src is None:
    print('Error : Loading image')
else:
    print('OK : Loading image')
    img = img_ori.copy()

intensity = img[100,100]
print(f'img[100,100]={intensity}')
```

각 pixel의 값 수정은 다음과 같음.

```
img[100,100] = [255,255,255]
print(img[100,100])
```

> **Warning**  
>
> * `Numpy`는 array(배열) 구조에 최적화된 라이브러리이기 때문에, for문 등을 통해 pixel하나씩 접근하는 방식은 권장되지 않음.

특정 region을 보는 방법은 slicing을 이용한다.

```Python
tmp = img[200:250,-300:-100]
print(tmp.shape)
plt.imshow(tmp[...,::-1])
plt.axis('off')
plt.show()
```

## `ndarray.item()` and `ndarray.itemset()`

개별 pixel에 접근하는 보다 나은 방법이긴 하지만, 가급적 하나의 pixel에 접근하는 방법보다 slicing을 통한 접근 또는 matrix 연산 또는 broadcasting등을 활용한 처리가 효과적이다.

> ## Note
>
> * For individual pixel access, `Numpy` array methods, `array.item()` and `array.itemset()` is considered to be better. 
> * But it always returns a **scalar**. 
> * So if you want to access all B,G,R values, you need to call `array.item()` separately for all.

```Python
# accessing RED value
img.item(10,10,2)

# modifying RED value
img.itemset((10,10,2),100)
img.item(10,10,2)
```

## Accessing Image Properties

Image properties include 

* number of rows, columns and channels, 
* type of image data, 
* number of pixels 
* etc.

**Shape of image** is accessed by `img.shape`. 
* It returns a tuple of number of rows, columns and channels (if image is color):
